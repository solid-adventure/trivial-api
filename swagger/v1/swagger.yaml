---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/activity_entries":
    get:
      summary: Retrieve the list of activity
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: app_id
        in: query
        required: true
      - name: limit
        in: query
        required: false
      responses:
        '200':
          description: Activity listing returned
          content:
            application/json:
              example:
              - id: 20
                user_id: 97
                app_id: 9044fb1d343463
                activity_type: request
                source: localhost
                status: '200'
                duration_ms: 1503
                payload:
                  test_data: '12345'
                diagnostics:
                  errors: []
                  events: []
                created_at: '2022-03-22T19:31:00.245Z'
                updated_at: '2022-03-22T19:31:00.245Z'
              - id: 19
                user_id: 97
                app_id: 9044fb1d343463
                activity_type: build
                source:
                status: success
                duration_ms: 2839
                payload:
                diagnostics:
                created_at: '2022-03-22T19:31:00.242Z'
                updated_at: '2022-03-22T19:31:00.242Z'
              schema:
                type: array
                items:
                  type: object
                  properties:
                    app_id:
                      type: string
                    activity_type:
                      type: string
                    status:
                      type: string
                      nullable: true
                    source:
                      type: string
                      nullable: true
                    duration_ms:
                      type: integer
                      nullable: true
                    payload:
                      type: object
                      nullable: true
                    diagnostics:
                      type: object
                      nullable: true
                  required:
                  - app_id
                  - activity_type
    post:
      summary: Log new activity
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters: []
      responses:
        '201':
          description: Activity logged
          content:
            application/json:
              example:
                id: 21
                user_id: 98
                app_id: 9a17d4ff7aaedf
                activity_type: request
                source: localhost
                status:
                duration_ms:
                payload:
                  test_data: '12345'
                diagnostics:
                created_at: '2022-03-22T19:31:00.612Z'
                updated_at: '2022-03-22T19:31:00.612Z'
              schema:
                type: object
                properties:
                  app_id:
                    type: string
                  activity_type:
                    type: string
                  status:
                    type: string
                    nullable: true
                  source:
                    type: string
                    nullable: true
                  duration_ms:
                    type: integer
                    nullable: true
                  payload:
                    type: object
                    nullable: true
                  diagnostics:
                    type: object
                    nullable: true
                required:
                - app_id
                - activity_type
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                app_id:
                  type: string
                activity_type:
                  type: string
                status:
                  type: string
                  nullable: true
                source:
                  type: string
                duration_ms:
                  type: integer
                  nullable: true
                payload:
                  type: object
                  nullable: true
                diagnostics:
                  type: object
                  nullable: true
              required:
              - app_id
              - activity_type
              example:
                app_id: 9a17d4ff7aaedf
                activity_type: request
                source: localhost
                payload:
                  test_data: '12345'
  "/apps/{id}/api_key":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
    post:
      summary: Obtain a new API key
      tags:
      - API Keys
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: API key issued
          content:
            application/json:
              example:
                api_key: eyJhbGciOiJSUzI1NiJ9.eyJhcHAiOiJjMjllMDQzNzNjOWU4ZSIsImV4cCI6MTY0ODU4MjI2MH0.kXePZo-034rH0RhpgQ_LgcSNvsQaODfUZfL2vRqaiAWzD600qWgsSbdbresNIX6_B7tAPTDWgHiFzR8JgblQPIc7VfNLmFxgC2M8T6yxFcOLqhyv0VqAagMywxdCsGH_tBQDVa82j0HnJTjBlmumtwZQq03H2v_R3rX2qeZk1_cbdqPzx3cnZjhI2uaRrURG4LzgM7dHxHl3zOBdpBsM69rrdZgg72scFgfLZW8L7qWbGaiqG3BfTje00sPOG6dpRtYYblXnOAJiblgqh5dZ7iW7i2ricmszXxiuf1ka_hZpY_MbQpLOD1D-oQXjc7ungM6BCIdhY1GHiNENU3VryQ
              schema:
                type: object
                properties:
                  api_key:
                    type: string
    put:
      summary: Refresh an expired API key
      tags:
      - API Keys
      parameters: []
      security:
      - app_api_key: []
      responses:
        '200':
          description: New API key issued and stored in credentials
          content:
            application/json:
              example:
                api_key: eyJhbGciOiJSUzI1NiJ9.eyJhcHAiOiJkNmZmNDNmNjczNzc5NyIsImV4cCI6MTY0ODU4MjI2MX0.RW-eGabT7g0Z9LeiwV0TG1nQH5kPczrtOwSpKHH5EARBqiWyDbZH2PfcdDg9rasFK6y9rtwdGBW3P10NltGSIHP1R-upTJ4_cVEu8eXm-_vGwMeGbWr7vc0JDUzPkBFV3WmrqxpnY0yQojmzgLkITOFaouqr2o2E7h3JD6lIZvHJVH2uh_nwW7lb7RzgI6Vc2juIZRHwMEBKzgxbJfQmpHC8V8buvOW2yw2hGoseteLF-7h3sb5WEZMXjtLL-6IubH1iIudU0xEzoQHitoc85MYWNmUn_mY364XpPVdIAr-OZa8xZRxQaKI3sgbSIiC_ZO19GB7KARp_71l1Az84pA
              schema:
                type: object
                properties:
                  api_key:
                    type: string
        '401':
          description: Authentication failed
        '409':
          description: API key does not match key stored in credentials
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: string
              example:
                path: '1.1'
  "/apps":
    get:
      summary: List the current user's applications
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      responses:
        '200':
          description: App listing
          content:
            application/json:
              example:
              - id: 59
                user_id: 103
                name: 526fc221e65f79
                port: 3001
                created_at: '2022-03-22T19:31:02.126Z'
                updated_at: '2022-03-22T19:31:02.126Z'
                discarded_at:
                hostname: 526fc221e65f79
                domain: staging.trivialapps.io
                load_balancer: staging-lb
                descriptive_name: 'Test App #7'
                aws_role: testlambda-ex-1
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    created_at:
                      type: string
                    updated_at:
                      type: string
                    hostname:
                      type: string
                    domain:
                      type: string
                    load_balancer:
                      type: string
                    descriptive_name:
                      type: string
                    aws_role:
                      type: string
                  required:
                  - id
                  - name
                  - created_at
                  - updated_at
                  - hostname
                  - domain
                  - load_balancer
                  - descriptive_name
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
    post:
      summary: Create a new application
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters: []
      responses:
        '200':
          description: App created
          content:
            application/json:
              example:
                id: 62
                user_id: 105
                name: 6210c47ce05391
                port: 3002
                created_at: '2022-03-22T19:31:02.740Z'
                updated_at: '2022-03-22T19:31:02.740Z'
                discarded_at:
                hostname: 6210c47ce05391
                domain: staging.trivialapps.io
                load_balancer: staging-lb
                descriptive_name: A Test
                aws_role: testlambda-ex-1
              schema:
                type:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    created_at:
                      type: string
                    updated_at:
                      type: string
                    hostname:
                      type: string
                    domain:
                      type: string
                    load_balancer:
                      type: string
                    descriptive_name:
                      type: string
                    aws_role:
                      type: string
                  required:
                  - id
                  - name
                  - created_at
                  - updated_at
                  - hostname
                  - domain
                  - load_balancer
                  - descriptive_name
        '422':
          description: Missing or invalid field
          content:
            application/json:
              example:
                errors:
                - Descriptive name can't be blank
                - Descriptive name is too short (minimum is 3 characters)
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                descriptive_name:
                  type: string
              required:
              - descriptive_name
              example:
                descriptive_name: A Test
  "/apps/{appId}":
    get:
      summary: Retrieve details for the app with the given id (name field)
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: appId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: App details
          content:
            application/json:
              example:
                id: 65
                user_id: 108
                name: b6ff15abbe5bac
                port: 3001
                created_at: '2022-03-22T19:31:03.600Z'
                updated_at: '2022-03-22T19:31:03.600Z'
                discarded_at:
                hostname: b6ff15abbe5bac
                domain: staging.trivialapps.io
                load_balancer: staging-lb
                descriptive_name: 'Test App #12'
                aws_role: testlambda-ex-1
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  created_at:
                    type: string
                  updated_at:
                    type: string
                  hostname:
                    type: string
                  domain:
                    type: string
                  load_balancer:
                    type: string
                  descriptive_name:
                    type: string
                  aws_role:
                    type: string
                required:
                - id
                - name
                - created_at
                - updated_at
                - hostname
                - domain
                - load_balancer
                - descriptive_name
        '404':
          description: No app found for the current user with that id
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
    put:
      summary: Update the app
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: appId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: App updated
          content:
            application/json:
              example:
                user_id: 111
                id: 68
                descriptive_name: A New Name
                name: eb4a1821b136d5
                port: 3001
                hostname: eb4a1821b136d5
                domain: staging.trivialapps.io
                load_balancer: staging-lb
                created_at: '2022-03-22T19:31:04.438Z'
                updated_at: '2022-03-22T19:31:04.455Z'
                discarded_at:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  created_at:
                    type: string
                  updated_at:
                    type: string
                  hostname:
                    type: string
                  domain:
                    type: string
                  load_balancer:
                    type: string
                  descriptive_name:
                    type: string
                  aws_role:
                    type: string
                required:
                - id
                - name
                - created_at
                - updated_at
                - hostname
                - domain
                - load_balancer
                - descriptive_name
        '404':
          description: No app found for the current user with that id
        '422':
          description: Missing or invalid field
          content:
            application/json:
              example:
                errors:
                - Descriptive name can't be blank
                - Descriptive name is too short (minimum is 3 characters)
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                descriptive_name:
                  type: string
              example:
                descriptive_name: A New Name
    delete:
      summary: Delete the app
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: appId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: App deleted
        '404':
          description: No app found for the current user with that id
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
  "/apps/name_suggestion":
    get:
      summary: Retrieve a suggested descriptive name for a new app
      tags:
      - Apps
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      responses:
        '200':
          description: New name suggestion
          content:
            application/json:
              example:
                suggestion: Sound Evolution
              schema:
                type: object
                properties:
                  suggestion:
                    type: string
                required:
                - suggestion
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
  "/auth":
    post:
      summary: Register a user
      tags:
      - Auth
      parameters: []
      responses:
        '200':
          description: user created
          content:
            application/json:
              example:
                status: success
                data:
                  id: 120
                  provider: email
                  uid: jane.doe@example.test
                  name: Jane Doe
                  email: jane.doe@example.test
                  created_at: '2022-03-22T19:31:07.035Z'
                  updated_at: '2022-03-22T19:31:07.040Z'
                  role: member
                  approval: approved
                  color_theme:
                  allow_password_change: false
                  aws_role:
        '422':
          description: unprocessable entity - email taken; name, email, password blank
            or too short!
          content:
            application/json:
              example:
                status: error
                data:
                  id:
                  provider: email
                  uid: ''
                  name: Jane Doe
                  email: jane.doe@example.test
                  created_at:
                  updated_at:
                  role: member
                  approval: pending
                  color_theme:
                  allow_password_change: false
                  aws_role:
                errors:
                  password:
                  - can't be blank
                  full_messages:
                  - Password can't be blank
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
                name:
                  type: string
              required:
              - email
              - password
              - name
              example:
                email: jane.doe@example.test
                password: supersecret
                name: Jane Doe
  "/auth/sign_in":
    post:
      summary: Sign in a user
      tags:
      - Auth
      parameters: []
      responses:
        '200':
          description: user logged in
          content:
            application/json:
              example:
                data:
                  id: 121
                  aws_role: testlambda-ex-1
                  email: user24@example.test
                  provider: email
                  name: Test User
                  uid: user24@example.test
                  role: member
                  approval: approved
                  color_theme:
                  allow_password_change: false
        '401':
          description: unauthorized - email or password is wrong
          content:
            application/json:
              example:
                success: false
                errors:
                - Invalid login credentials. Please try again.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
              required:
              - email
              - password
              example:
                email: user24@example.test
                password: insecure
  "/auth/sign_out":
    delete:
      summary: Sign out a user
      tags:
      - Auth
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      responses:
        '200':
          description: user signed out
          content:
            application/json:
              example:
                success: true
        '404':
          description: unauthorized - invalid login credentials in the header
          content:
            application/json:
              example:
                success: false
                errors:
                - User was not found or was not logged in.
  "/credential_sets":
    get:
      summary: Return a list of credential sets for the account
      tags:
      - Credential Sets
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: Credential sets returned
          content:
            application/json:
              example:
                credential_sets:
                - id: 0ce826b6-0122-4702-8afa-6ed440ffa8cf
                  name: Twilio
                  credential_type: TwilioCredentials
                  created_at: '2022-03-22T19:31:09.709Z'
                  updated_at: '2022-03-22T19:31:09.709Z'
              schema:
                type: object
                properties:
                  credential_sets:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        credential_type:
                          type: string
                      required:
                      - id
                      - name
                      - credential_type
                required:
                - credential_sets
    post:
      summary: Create a new credential set
      tags:
      - Credential Sets
      parameters: []
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: Credential set created
          content:
            application/json:
              example:
                credential_set:
                  id: 6456a2cd-ec70-4a71-bb37-1fc0dd311db8
                  name: Mailgun
                  credential_type: MailgunCredentials
                  created_at: '2022-03-22T19:31:10.025Z'
                  updated_at: '2022-03-22T19:31:10.025Z'
              schema:
                type: object
                properties:
                  credential_set:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      credential_type:
                        type: string
                    required:
                    - id
                    - name
                    - credential_type
                required:
                - credential_set
        '422':
          description: Invalid credential set body
          content:
            application/json:
              example:
                errors:
                - Name can't be blank
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                credential_set:
                  type: object
                  properties:
                    name:
                      type: string
                    credential_type:
                      type: string
                  required:
                  - name
                  - credential_type
                credentials:
                  type: object
              required:
              - credential_set
              example:
                credential_set:
                  name: Mailgun
                  credential_type: MailgunCredentials
                credentials:
                  api_key: "+7Ucdca1LUQ="
                  domain: example.test
  "/credential_sets/{set_id}":
    parameters:
    - name: set_id
      in: path
      required: true
      schema:
        type: string
    get:
      summary: Access the credential data for a set
      tags:
      - Credential Sets
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: Credential data returned for set
          content:
            application/json:
              example:
                credential_set:
                  id: 96e85c04-6efb-472a-93b8-2244ac84bd66
                  name: Twilio
                  credential_type: TwilioCredentials
                  created_at: '2022-03-22T19:31:10.701Z'
                  updated_at: '2022-03-22T19:31:10.701Z'
                credentials:
                  account_sid: fa8f7fa53659d6de
                  auth_token: Whe8Y5poyQo=
              schema:
                type: object
                properties:
                  credential_set:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      credential_type:
                        type: string
                    required:
                    - id
                    - name
                    - credential_type
                  credentials:
                    type: object
                required:
                - credential_set
                - credentials
        '404':
          description: Incorrect id
    put:
      summary: Update the credential set and/or its credential data
      tags:
      - Credential Sets
      parameters: []
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: Credentials updated
          content:
            application/json:
              example:
                credential_set:
                  id: 5b4540bc-1041-40fb-8cdf-71fb786c0be1
                  name: New Name
                  credential_type: TwilioCredentials
                  created_at: '2022-03-22T19:31:11.613Z'
                  updated_at: '2022-03-22T19:31:11.628Z'
              schema:
                type: object
                properties:
                  credential_set:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      credential_type:
                        type: string
                    required:
                    - id
                    - name
                    - credential_type
                required:
                - credential_set
        '422':
          description: Invalid credential set body
          content:
            application/json:
              example:
                errors:
                - Name can't be blank
        '404':
          description: Incorrect id
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                credential_set:
                  type: object
                  properties:
                    name:
                      type: string
                    credential_type:
                      type: string
                  required:
                  - name
                  - credential_type
                credentials:
                  type: object
              example:
                credential_set:
                  name: New Name
                  credential_type: TwilioCredentials
                credentials:
                  account_sid: fa8f7fa53659d6de
                  auth_token: Whe8Y5poyQo=
    patch:
      summary: Update a single value within the credential data for a set
      tags:
      - Credential Sets
      parameters: []
      security:
      - app_api_key: []
      responses:
        '200':
          description: Credentials updated
          content:
            application/json:
              example:
                ok: true
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                - ok
        '422':
          description: Invalid path or current value
          content:
            application/json:
              example:
                ok: false
                error: Incorrect value or path
        '404':
          description: Incorrect id
        '401':
          description: Invalid or missing API key
          content:
            application/json:
              example:
                errors:
                - Unauthorized!
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: array
                  items: string
                credentials:
                  type: object
                  properties:
                    current_value:
                      type: string
                    new_value:
                      type: string
                  required:
                  - current_value
                  - new_value
              required:
              - path
              - credentials
              example:
                path:
                - code_grant
                - access_token
                credentials:
                  current_value: Whe8Y5poyQo=
                  new_value: zTeYlkd9yzo=
    delete:
      summary: Delete the credential set and its credential data
      tags:
      - Credential Sets
      security:
      - access_token: []
        client: []
        expiry: []
        uid: []
      responses:
        '200':
          description: Credentials deleted
        '404':
          description: Incorrect id
  "/credential_sets/{set_id}/api_key":
    parameters:
    - name: set_id
      in: path
      required: true
      schema:
        type: string
    put:
      summary: Refresh an expired API key
      tags:
      - Credential Sets
      parameters: []
      security:
      - app_api_key: []
      responses:
        '200':
          description: New API key issued and stored in credentials
          content:
            application/json:
              example:
                api_key: eyJhbGciOiJSUzI1NiJ9.eyJhcHAiOiJkMTdlNjJlNjZjM2Q5YyIsImV4cCI6MTY0ODU4MjI3NX0.Wdhmdk8QOapPTwgHuczRpkAgbswSwuVS1PjX2zdLNGCzqWeP37ZyiQz0KMwDLXA5Z2KFt7Tr18X-tQD3-LmkWvRmwAs2nASGTek9Minw0gYquo-3vZU5bUS-WdMnbpIMmniokHUdeG03V39Wxo1kAwI5jjzKkPfGzoPdIdsyV9L5xXyyF7pGP4KYZpMID6M-Sb_biVW5C7X-qrCQGgEGIuoSTGmYZwOmAv-z8yySrxKmW2DlyWEbHEJYOZ97VAEIWdpOOsuSzoxbOb_bbFYmImqWRDzZaVoBz7qa2dX5WfcoBw-eALtQw0wGW4G06uAyFn-wmZkZ1Hci9GXBUhoMPw
              schema:
                type: object
                properties:
                  api_key:
                    type: string
                  required:
                  - api_key
        '401':
          description: Authentication failed
        '409':
          description: API key does not match key stored in credentials
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: string
              example:
                path: api_key
  "/apps/{id}/credentials":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
    patch:
      summary: Refresh an expired API key
      tags:
      - App Credentials
      parameters: []
      security:
      - app_api_key: []
      responses:
        '200':
          description: Single credential value updated
          content:
            application/json:
              example:
                ok: true
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
        '401':
          description: Authentication failed
          content:
            application/json:
              example:
                errors:
                - Unauthorized!
        '400':
          description: Invalid path or incorrect stored value
          content:
            application/json:
              example:
                ok: false
                error: Incorrect value or path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: array
                  items:
                    type: string
                credentials:
                  type: object
                  properties:
                    current_value:
                      type: string
                    new_value:
                      type: string
              example:
                path:
                - '1'
                - '1'
                - access_token
                credentials:
                  current_value: secret
                  new_value: new secret
  "/profile":
    get:
      summary: Show the logged in user's profile
      tags:
      - Profile
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      responses:
        '200':
          description: Current profile
          content:
            application/json:
              example:
                user:
                  id: 144
                  name: Test User
                  email: user47@example.test
                  role: admin
                  approval: pending
                  color_theme:
                  created_at: '2022-03-22T19:31:17.023Z'
        '401':
          description: Not authorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
    put:
      summary: Update the logged in user's profile
      tags:
      - Profile
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters: []
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              example:
                user:
                  id: 146
                  name: My New Name
                  email: user49@example.test
                  role: admin
                  approval: pending
                  color_theme: Light
                  created_at: '2022-03-22T19:31:17.580Z'
        '400':
          description: Bad request
          content:
            application/json:
              example:
                errors:
                - Name can't be blank
                - Name is too short (minimum is 3 characters)
        '401':
          description: Not authorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                color_theme:
                  type: string
              example:
                name: My New Name
                color_theme: Light
  "/users":
    get:
      summary: Show the list of the users
      tags:
      - User
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      responses:
        '200':
          description: users listed
          content:
            application/json:
              example:
                users:
                - id: 149
                  name: Test User
                  email: user52@example.test
                  role: admin
                  approval: pending
                  color_theme:
                  created_at: '2022-03-22T19:31:18.415Z'
        '401':
          description: unauthorized or not an admin user
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
    post:
      summary: Create a user
      tags:
      - User
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters: []
      responses:
        '201':
          description: user created
          content:
            application/json:
              example:
                user:
                  id: 152
                  name: Jane Doe
                  email: jane.doe@example.test
                  role: member
                  approval: approved
                  color_theme:
                  created_at: '2022-03-22T19:31:19.231Z'
        '400':
          description: bad request
          content:
            application/json:
              example:
                errors:
                - Email can't be blank
        '401':
          description: unauthorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                role:
                  type: string
                approval:
                  type: string
              required:
              - email
              - password
              - name
              example:
                name: Jane Doe
                email: jane.doe@example.test
                password: supersecret
                role: member
                approval: approved
  "/users/{userId}":
    get:
      summary: Show the user with userId
      tags:
      - User
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: show user
          content:
            application/json:
              example:
                user:
                  id: 155
                  name: Test User
                  email: user57@example.test
                  role: member
                  approval: approved
                  color_theme:
                  created_at: '2022-03-22T19:31:20.300Z'
        '404':
          description: No user found with that id
        '401':
          description: unauthorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
    put:
      summary: Update the User with userId
      tags:
      - User
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: user updated
          content:
            application/json:
              example:
                user:
                  id: 160
                  name: New Name
                  email: user62@example.test
                  role: member
                  approval: approved
                  color_theme:
                  created_at: '2022-03-22T19:31:21.633Z'
        '400':
          description: bad request
          content:
            application/json:
              example:
                errors:
                - Name can't be blank
                - Name is too short (minimum is 3 characters)
        '404':
          description: No user found with that id
        '401':
          description: unauthorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                role:
                  type: string
                approval:
                  type: string
              example:
                name: New Name
    delete:
      summary: Destroy the team with userId
      tags:
      - User
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
      responses:
        '204':
          description: user deleted
        '404':
          description: No user found with that id
        '401':
          description: unauthorized
          content:
            application/json:
              example:
                errors:
                - You need to sign in or sign up before continuing.
  "/webhooks":
    get:
      summary: Retrieve the list of logged requests
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: app_id
        in: query
        required: true
      - name: limit
        in: query
        required: false
      responses:
        '200':
          description: Request listing returned
          content:
            application/json:
              example:
              - id: 23
                user_id: 172
                app_id: 0b04d9f21fd287
                update_id:
                activity_type: request
                source: localhost
                status: '200'
                payload:
                  test_data: '12345'
                diagnostics:
                  errors: []
                  events: []
                created_at: '2022-03-22T19:31:24.848Z'
                updated_at: '2022-03-22T19:31:24.848Z'
              schema:
                type: array
                items:
                  type: object
                  properties:
                    app_id:
                      type: string
                    update_id:
                      type: string
                      nullable: true
                    activity_type:
                      type: string
                    status:
                      type: string
                      nullable: true
                    source:
                      type: string
                    payload:
                      type: object
                      nullable: true
                    diagnostics:
                      type: object
                      nullable: true
                  required:
                  - app_id
                  - source
                  - payload
    post:
      summary: Log the start of a request
      tags:
      - Activity
      parameters: []
      responses:
        '201':
          description: Request logged
          content:
            application/json:
              example:
                id: 24
                user_id: 173
                app_id: a955e50c655735
                update_id: de4e0c7a-feb6-4dfe-bb09-1975a4790b9d
                activity_type: request
                source: localhost
                status:
                payload:
                  test_data: '12345'
                diagnostics:
                created_at: '2022-03-22T19:31:25.148Z'
                updated_at: '2022-03-22T19:31:25.148Z'
              schema:
                type: object
                properties:
                  app_id:
                    type: string
                  update_id:
                    type: string
                  activity_type:
                    type: string
                  status:
                    type: string
                    nullable: true
                  source:
                    type: string
                  payload:
                    type: object
                    nullable: true
                  diagnostics:
                    type: object
                    nullable: true
                required:
                - app_id
                - update_id
                - source
                - payload
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                app_id:
                  type: string
                status:
                  type: string
                source:
                  type: string
                payload:
                  type: object
                diagnostics:
                  type: object
              required:
              - app_id
              - source
              - payload
              example:
                app_id: a955e50c655735
                source: localhost
                payload: '{"test_data":"12345"}'
  "/webhooks/{webhookId}":
    get:
      summary: Retrieve the details of a single request log
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: webhookId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Request log details returned
          content:
            application/json:
              example:
                id: 25
                user_id: 174
                app_id: adda3ff1ce7941
                update_id:
                activity_type: request
                source: localhost
                status: '200'
                payload:
                  test_data: '12345'
                diagnostics:
                  errors: []
                  events: []
                created_at: '2022-03-22T19:31:25.419Z'
                updated_at: '2022-03-22T19:31:25.419Z'
              schema:
                type: object
                properties:
                  app_id:
                    type: string
                  update_id:
                    type: string
                    nullable: true
                  activity_type:
                    type: string
                  status:
                    type: string
                    nullable: true
                  source:
                    type: string
                  payload:
                    type: object
                    nullable: true
                  diagnostics:
                    type: object
                    nullable: true
                required:
                - app_id
                - source
                - payload
    put:
      summary: Update a request log with status and diagnostics
      tags:
      - Activity
      parameters:
      - name: webhookId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Request log updated
          content:
            application/json:
              example:
                id: 26
                user_id: 175
                app_id: 4cedb33f4c661f
                update_id: be607f0e-4e28-4d74-b739-aa3a1c6ac798
                activity_type: request
                source: localhost
                status: '500'
                payload:
                  test_data: '12345'
                diagnostics:
                  errors:
                  - name: FetchError
                    stack: |-
                      FetchError: request to http://localhost:5000/bogus failed, reason: connect ECONNREFUSED 127.0.0.1:5000
                          at processTicksAndRejections (internal/process/task_queues.js:84:21)
                  events:
                  - event: POST
                    detail:
                      url: http://localhost:5000/bogus
                      body: "{}"
                      method: POST
                      headers:
                        Content-Type: application/json
                    success: true
                created_at: '2022-03-22T19:31:25.719Z'
                updated_at: '2022-03-22T19:31:25.736Z'
              schema:
                type: object
                properties:
                  app_id:
                    type: string
                  update_id:
                    type: string
                    nullable: true
                  activity_type:
                    type: string
                  status:
                    type: string
                    nullable: true
                  source:
                    type: string
                  payload:
                    type: object
                    nullable: true
                  diagnostics:
                    type: object
                    nullable: true
                required:
                - app_id
                - source
                - payload
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                duration_ms:
                  type: integer
                diagnostics:
                  type: object
              required:
              - status
              example:
                status: '500'
                duration_ms: 2471
                diagnostics:
                  errors:
                  - name: FetchError
                    stack: |-
                      FetchError: request to http://localhost:5000/bogus failed, reason: connect ECONNREFUSED 127.0.0.1:5000
                          at processTicksAndRejections (internal/process/task_queues.js:84:21)
                  events:
                  - event: POST
                    detail:
                      url: http://localhost:5000/bogus
                      body: "{}"
                      method: POST
                      headers:
                        Content-Type: application/json
                    success: true
  "/webhooks/{appId}/send":
    post:
      summary: Send a request to an app
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: appId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Request sent
          content:
            application/json:
              example:
                status: 200
                message: OK
              schema:
                type: object
                properties:
                  status:
                    type: integer
                  message:
                    type: string
                required:
                - status
                - message
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
              required:
              - payload
  "/webhooks/{webhookId}/resend":
    post:
      summary: Re-send the payload from a request to an app
      tags:
      - Activity
      security:
      - access_token: []
        client: []
        uid: []
        token_type: []
      parameters:
      - name: webhookId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Request re-sent
          content:
            application/json:
              example:
                status: 200
                message: OK
              schema:
                type: object
                properties:
                  status:
                    type: integer
                  message:
                    type: string
                required:
                - status
                - message
servers:
- url: "{defaultHost}"
  variables:
    defaultHost:
      default: https://trivial-api-staging.herokuapp.com/
components:
  securitySchemes:
    access_token:
      type: apiKey
      name: access-token
      in: header
    client:
      type: apiKey
      name: client
      in: header
    expiry:
      type: apiKey
      name: expiry
      in: header
    uid:
      type: apiKey
      name: uid
      in: header
    app_api_key:
      type: http
      scheme: bearer
      bearerFormat: JWT
